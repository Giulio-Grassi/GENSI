{"ast":null,"code":"var _jsxFileName = \"/Users/gg/dev/egoSurveyReact/egoSurveyReact/src/components/nodeRow.jsx\",\n    _s = $RefreshSig$();\n\n/**\n * arranges the nodes in a row so it's possible to select them,\n * once a node is selected it bumps up and changes color\n */\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Box, DataTable, Button, Layer, Heading, TextInput } from \"grommet\";\nimport { select, forceSimulation, forceManyBody, forceCollide, forceCenter, tickFormat } from 'd3';\nimport useResizeObserver from './useResizeObserver';\nimport { forceLink } from 'd3-force';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function NodeRow({\n  initialNodes,\n  selectedIds,\n  setSelectedIds,\n  filterYou = true\n}) {\n  _s();\n\n  const CIRCLE_RADIUS = 30;\n  const [nodes, setNodes] = React.useState([]);\n  const [didInitialise, setDidInitialise] = React.useState(false);\n  const [didFilter, setDidFilter] = React.useState(false);\n  const svgRef = useRef(); //gets a ref for the svg in which d3 renders in \n\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef); //used to resize \n  // will be called initially and on every data change\n\n  useEffect(() => {\n    if (!dimensions) return;\n    console.log(\"prefilter nodes \", nodes);\n\n    if (!didInitialise) {\n      setDidInitialise(true);\n      setNodes(initialNodes);\n\n      if (filterYou && !didFilter) {\n        //const filteredNodes = nodes.filter(e => e.id !=  \"You\") //removing you as we do not need it for this screen, TODO make it a var\n        setNodes(initialNodes.filter(e => e.id != \"You\"));\n        setDidFilter(true);\n        console.log(\"FILTERED\");\n      }\n    }\n\n    console.log(\"postfilter nodes \", nodes);\n    console.log(\"initial nodes\", initialNodes);\n    const manualPadding = 100;\n    const nodeOffset = (dimensions.width - 2 * manualPadding) / nodes.length;\n    console.log(\"width\", dimensions.width);\n    const svg = select(svgRef.current); // centering workaround\n\n    svg.attr(\"viewBox\", [-dimensions.width / 2, -dimensions.height / 2, dimensions.width, dimensions.height]);\n    const node = svg.selectAll(\".node\").data(nodes).join(\"g\").attr('class', 'node') //.attr(\"x\", d => d.x = (-dimensions.width / 2  + manualPadding + nodeOffset/2 + d.index * nodeOffset))\n    //.attr(\"y\", d => d.y = 0)\n    //.attr(\"selected\", d => d.selected)\n    //.attr(\"transform\",d => `translate(${d.x}, ${d.y})`)\n    .on(\"mouseover\", handleMouseOver).on(\"mouseout\", handleMouseOut).on(\"click\", handleMouseClick);\n    node.append('circle') //.join(\"g\")\n    .attr(\"r\", CIRCLE_RADIUS).attr(\"fill\", function (d) {\n      return '#5b8075';\n    });\n    node.append(\"text\") //.join(\"g\")\n    .text(d => d.id).attr('text-anchor', 'middle').attr('alignment-baseline', 'middle').style('fill', '#000').style('font-size', '20px');\n\n    function handleMouseClick(d, i) {\n      console.log(\"clicked\"); // nodes[this.index].selected = true\n\n      setSelectedIds( //nodes[i.index].selected = true  //THIS IS FAULTY \n      selectedIds.add(nodes[i.index]));\n      console.log(\"clicked nodes\", nodes);\n      console.log(\"indexed node\", nodes[i.index]);\n      console.log(d);\n    } // Create Event Handlers for mouse\n\n\n    function handleMouseOver(d, i) {\n      // Add interactivity\n      select(this).selectChild('circle') //select circle at mouseposition... otherwise label gets in the way\n      .transition().attr(\"fill\", function (d) {\n        return '#ffa500';\n      }).attr(\"r\", CIRCLE_RADIUS * 1.5);\n    }\n\n    function handleMouseOut(d, i) {\n      // Use D3 to select element, change color back to normal\n      select(this).selectChild('circle').transition().attr(\"r\", CIRCLE_RADIUS).attr(\"fill\", function (d) {\n        return '#5b8075';\n      });\n    } //   node.checked = function (val) { https://bl.ocks.org/Lulkafe/c77a36d5efb603e788b03eb749a4a714\n    //     if(val === undefined) {\n    //         return checked;    //     } else {\n    //         checked = val;\n    //         return checkBox;\n    //     }\n    // }\n    //more than having the simulation, just have the posittions in the state?\n\n\n    const simulation = forceSimulation(nodes);\n    simulation.on(\"tick\", () => {\n      node //  // .attr(\"x\", d => (d.index * nodeOffset) + manualPadding - ( -dimensions.width / 2))\n      //   //.attr(\"transform\", d => `translate(${ -((d.index * nodeOffset) + manualPadding - (dimensions.width / 2))}, ${d.selected ? d.y : 100 })`);\n      .attr(\"transform\", d => `translate(${d.x = -dimensions.width / 2 + manualPadding + nodeOffset / 2 + d.index * nodeOffset}, ${d.selected ? d.y = 0 : d.y = 100})`); //console.log(\"simulation nodes \", nodes)\n    });\n  }, [nodes, dimensions]); //TODO check if this nodes param here is right and what it does...\n\n  return /*#__PURE__*/_jsxDEV(Box, {\n    fill: true,\n    ref: wrapperRef,\n    pad: \"small\",\n    height: \"xxlarge\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 21\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 148,\n    columnNumber: 17\n  }, this);\n}\n\n_s(NodeRow, \"W8QtfwPQ+KjiauFYySfBMy6fMP0=\", false, function () {\n  return [useResizeObserver];\n});\n\n_c = NodeRow;\n\nvar _c;\n\n$RefreshReg$(_c, \"NodeRow\");","map":{"version":3,"sources":["/Users/gg/dev/egoSurveyReact/egoSurveyReact/src/components/nodeRow.jsx"],"names":["React","useState","useEffect","useRef","Box","DataTable","Button","Layer","Heading","TextInput","select","forceSimulation","forceManyBody","forceCollide","forceCenter","tickFormat","useResizeObserver","forceLink","NodeRow","initialNodes","selectedIds","setSelectedIds","filterYou","CIRCLE_RADIUS","nodes","setNodes","didInitialise","setDidInitialise","didFilter","setDidFilter","svgRef","wrapperRef","dimensions","console","log","filter","e","id","manualPadding","nodeOffset","width","length","svg","current","attr","height","node","selectAll","data","join","on","handleMouseOver","handleMouseOut","handleMouseClick","append","d","text","style","i","add","index","selectChild","transition","simulation","x","selected","y"],"mappings":"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","sourcesContent":["/**\n * arranges the nodes in a row so it's possible to select them,\n * once a node is selected it bumps up and changes color\n */\n\n import React, { useState, useEffect, useRef} from 'react';\n import { Box, DataTable, Button, Layer, Heading, TextInput } from \"grommet\";\nimport {select, forceSimulation, forceManyBody, forceCollide, forceCenter, tickFormat,} from 'd3'\nimport useResizeObserver from './useResizeObserver'\nimport { forceLink } from 'd3-force';\n\n\nexport default function NodeRow({\n     initialNodes,\n     selectedIds,\n     setSelectedIds,\n    filterYou = true\n    }) {\n    const CIRCLE_RADIUS = 30;\n    const [nodes, setNodes] = React.useState([]);\n    const [didInitialise, setDidInitialise] = React.useState(false);\n    const [didFilter, setDidFilter] = React.useState(false)\n    const svgRef = useRef(); //gets a ref for the svg in which d3 renders in \n    const wrapperRef = useRef();\n    const dimensions = useResizeObserver(wrapperRef); //used to resize \n\n\n      // will be called initially and on every data change\n    useEffect(() => {\n      if (!dimensions) return;\n\n      console.log(\"prefilter nodes \", nodes)\n\n      if(!didInitialise){\n        setDidInitialise(true);\n        setNodes(initialNodes);\n      \n      if(filterYou && !didFilter){\n        //const filteredNodes = nodes.filter(e => e.id !=  \"You\") //removing you as we do not need it for this screen, TODO make it a var\n       \n       setNodes(initialNodes.filter(e => e.id !=  \"You\"))\n       setDidFilter(true)\n       console.log(\"FILTERED\")\n       \n      }\n    }\n      console.log(\"postfilter nodes \", nodes)\n      console.log (\"initial nodes\", initialNodes )\n\n\n        const manualPadding = 100\n        const nodeOffset = (dimensions.width - 2* manualPadding)/ nodes.length\n        console.log(\"width\", dimensions.width)\n        \n        const svg = select(svgRef.current);\n\n            // centering workaround\n    svg.attr(\"viewBox\", [\n        -dimensions.width / 2,\n        -dimensions.height / 2,\n        dimensions.width,\n        dimensions.height\n      ]);\n\n  const node = svg\n      .selectAll(\".node\")\n      .data(nodes)\n      .join(\"g\")\n      .attr('class', 'node')\n      //.attr(\"x\", d => d.x = (-dimensions.width / 2  + manualPadding + nodeOffset/2 + d.index * nodeOffset))\n      //.attr(\"y\", d => d.y = 0)\n      //.attr(\"selected\", d => d.selected)\n      //.attr(\"transform\",d => `translate(${d.x}, ${d.y})`)\n      .on(\"mouseover\", handleMouseOver)\n      .on(\"mouseout\", handleMouseOut)\n      .on(\"click\", handleMouseClick);\n\n\n  node.append('circle')\n      //.join(\"g\")\n      .attr(\"r\", CIRCLE_RADIUS)\n      .attr(\"fill\", function (d) { return '#5b8075'; });  \n\n\n  node.append(\"text\")\n      //.join(\"g\")\n      .text(d => d.id)\n      .attr('text-anchor', 'middle')\n      .attr('alignment-baseline', 'middle')\n      .style('fill', '#000')\n      .style('font-size', '20px');\n\n    \n      function handleMouseClick(d, i){\n\n        console.log(\"clicked\")\n        // nodes[this.index].selected = true\n        setSelectedIds(\n          //nodes[i.index].selected = true  //THIS IS FAULTY \n          selectedIds.add(nodes[i.index])\n        )\n        console.log(\"clicked nodes\", nodes)\n        console.log(\"indexed node\", nodes[i.index])\n        console.log(d);\n      }\n      // Create Event Handlers for mouse\n      function handleMouseOver(d, i) {  // Add interactivity\n\n        select(this).selectChild('circle') //select circle at mouseposition... otherwise label gets in the way\n        .transition()\n        .attr(\"fill\", function (d) { return '#ffa500'; })\n        .attr(\"r\", CIRCLE_RADIUS *1.5)\n      }\n\n  function handleMouseOut(d, i) {\n        // Use D3 to select element, change color back to normal\n        select(this).selectChild('circle')\n        .transition()\n        .attr(\"r\", CIRCLE_RADIUS)\n        .attr(\"fill\", function (d) { return '#5b8075'; })\n      }\n\n\n    //   node.checked = function (val) { https://bl.ocks.org/Lulkafe/c77a36d5efb603e788b03eb749a4a714\n\n    //     if(val === undefined) {\n    //         return checked;    //     } else {\n    //         checked = val;\n    //         return checkBox;\n    //     }\n    // }\n\n      //more than having the simulation, just have the posittions in the state?\n      \n      const simulation = forceSimulation(nodes)\n\n      simulation.on(\"tick\", () => {\n         node\n      //  // .attr(\"x\", d => (d.index * nodeOffset) + manualPadding - ( -dimensions.width / 2))\n      //   //.attr(\"transform\", d => `translate(${ -((d.index * nodeOffset) + manualPadding - (dimensions.width / 2))}, ${d.selected ? d.y : 100 })`);\n         .attr(\"transform\", d => `translate(${d.x = (-dimensions.width / 2  + manualPadding + nodeOffset/2 + d.index * nodeOffset)}, ${d.selected ? d.y = 0 : d.y = 100 })`);\n\n        //console.log(\"simulation nodes \", nodes)\n      });\n      }, [nodes, dimensions]); //TODO check if this nodes param here is right and what it does...\n\n        return( \n                <Box fill={true} ref={wrapperRef}  pad=\"small\" height=\"xxlarge\">\n                    <svg ref={svgRef}></svg>\n                </Box>\n        )\n}"]},"metadata":{},"sourceType":"module"}