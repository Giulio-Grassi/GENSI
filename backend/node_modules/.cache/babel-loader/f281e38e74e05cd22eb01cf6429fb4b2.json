{"ast":null,"code":"var _jsxFileName = \"/Users/gg/dev/egoSurveyReact/egoSurveyReact/src/components/lineBox.jsx\",\n    _s = $RefreshSig$();\n\n/**\n * arranges the nodes in a row so it's possible to select them,\n * once a node is selected it bumps up and changes color\n */\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Box, DataTable, Button, Text, Layer, Heading, TextInput } from \"grommet\";\nimport { select, drag, forceSimulation, forceManyBody, forceCollide, forceCenter, tickFormat, timeHour, timeout, selectAll } from 'd3';\nimport useResizeObserver from './useResizeObserver';\nimport { forceLink } from 'd3-force';\nimport { colors } from 'grommet/themes/base';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LineBox({\n  nodes,\n  question,\n  table,\n  setTable,\n  filterYou\n}) {\n  _s();\n\n  const CIRCLE_RADIUS = 20;\n  const svgRef = useRef(); //gets a ref for the svg in which d3 renders in \n\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef); //used to resize \n\n  const [nodesRepresentation, setNodesRepresentation] = React.useState(nodes.map(x => {\n    return {\n      id: x.getName(),\n      selected: false\n    };\n  })); //TODO NINAD, HERE THE BOXES ARE DECLERED, MAYBE MAKE A MODEL, IDK HOW U WANT TO MAKE  THE STATE OUT OF THESE.\n  //const boxes = [{id: \"1\", nodeColor: \"ffa500\"},{id: \"22\", nodeColor: \"ffa500\"},{id: \"333\", nodeColor: \"ffa500\"}, {id: \"4444444\", nodeColor: \"ffa500\"}]\n\n  const boxes = [];\n  question.getBoxes().forEach(x => {\n    boxes.push({\n      id: x.id,\n      nodeColor: x.colour\n    });\n  }); //keeps the state of which box is curently being hovered on\n\n  const [boxToDropIn, setBoxToDropIn] = React.useState(\"\");\n  const [draggingNode, setDraggingNode] = React.useState(\"\");\n  const memoizedCallback = useCallback(() => {\n    if (draggingNode !== \"\" && boxToDropIn !== \"\") setTable(table.insertRelation(question.id, draggingNode, boxToDropIn));\n    console.log(\"draggingNode\", draggingNode);\n    console.log(\"boxToDropIn\", boxToDropIn);\n  }, [draggingNode, boxToDropIn]);\n  /**\n   * useless use effect, just used to check if the logic was working, ultimately to be removed. \n   */\n\n  useEffect(() => {\n    console.log(\"useEffect draggingNode: \" + draggingNode);\n  }, [draggingNode]); //Temporary solution. ADD PADDING BETWEEN BOXES OF MINIMUM SIZE OF NODE. AND ALSO REDUCE NODE SIZE.\n\n  useEffect(() => {\n    console.log(\"useEffect box: \" + boxToDropIn);\n\n    if (draggingNode !== \"\") {\n      console.log(\"BEPPE: \" + draggingNode + \" & \" + boxToDropIn);\n      setTable(table.insertOrUpdateRelation(question.id, draggingNode, boxToDropIn));\n      const myboxArr = boxes.filter(box => box.id === boxToDropIn);\n      const mybox = myboxArr[0];\n      selectAll(\".node\").filter(function (d) {\n        return d.id === draggingNode;\n      }).selectChild().attr(\"fill\", function (d) {\n        return mybox.nodeColor;\n      });\n    }\n  }, [boxToDropIn]); // will be called initially and on every data change\n\n  useEffect(() => {\n    if (!dimensions) return; // console.log(\"width\", dimensions.width)\n\n    const svg = select(svgRef.current);\n    svg.selectAll(\"*\").remove(); //Clear canvas so no duplicates are trailed every refresh\n    // centering workaround\n\n    svg.attr(\"viewBox\", [-dimensions.width / 2, -dimensions.height / 2, dimensions.width, dimensions.height]);\n    /**\n     * Draws the nodes on screen, appends the callbacks.\n     */\n\n    const nodes = drawNodes(svg, nodesRepresentation, CIRCLE_RADIUS);\n    nodes.attr(\"transform\", (d, i) => `translate(${d.x = nodePositionFuncX(i, dimensions)}, ${d.y = nodePositionFuncY(i)})`).call(drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended)); // .attr(\"transform\", (d,i) => `translate(${d.x = }, ${d.y = 0 })`)\n\n    function nodePositionFuncX(i, dimensions) {\n      const manualPadding = 100;\n      const nodeOffset = (dimensions.width - 2 * manualPadding) / nodesRepresentation.length;\n      const x = -dimensions.width / 2 + manualPadding + nodeOffset / 2 + i * nodeOffset;\n      return x;\n    }\n\n    function nodePositionFuncY(i, dimensions) {\n      return 0;\n    }\n\n    function dragstarted(event, d) {\n      setDraggingNode(d.id);\n      console.log(\"dragstarted\", boxToDropIn);\n      select(this).raise().attr(\"stroke\", \"black\").style(\"pointer-events\", \"none\"); //this is done so that the mouseover event on the box can be detected\n    }\n\n    function dragged(event, d) {\n      console.log(\"dragged\", boxToDropIn);\n      select(this).attr(\"transform\", () => `translate(${d.x = event.x}, ${d.y = event.y})`);\n    }\n    /**\n     * TODO NINAD : insert here the logic to save the state of the node being in a box if \n     * if boxTodropIn is not empty. \n     * ISSUES: select with the box id doesn't seem to be working\n     * TODO: re insert the logic so that the node can be dragged again after it is dropped the first time \n     * @param {*} event \n     * @param {*} d \n     */\n\n\n    function dragended(event, d) {\n      setDraggingNode(\"\");\n      const thisObject = this;\n      /*setTimeout(function() {\n        console.log(\"dragended\", boxToDropIn)\n        if(boxToDropIn !== \"\"){\n          console.log(\"inside if\")\n          setTable(table.insertRelation(question.id, d.id, boxToDropIn))\n        }\n        select(thisObject).attr(\"stroke\", null)\n        .style(\"pointer-events\", \"auto\")\n      }, 100);*/\n\n      console.log(\"dragended\", boxToDropIn);\n\n      if (boxToDropIn !== \"\") {\n        console.log(\"inside if\");\n        setTable(table.insertRelation(question.id, d.id, boxToDropIn));\n      }\n\n      select(thisObject).attr(\"stroke\", null).style(\"pointer-events\", \"auto\");\n    } // ------FUNCTIONS FOR BOXES POSITION  AND SIZE  \n\n\n    const extraOuterPadding = 0; //this is extra for outer pad. total outer pad is manual + inner\n\n    const boxPadding = 70;\n\n    function boxPositionFuncX(dimensions, extraOuterPadding, i) {\n      const boxOffset = (dimensions.width - 2 * extraOuterPadding) / boxes.length;\n      const x = -boxWidth / 2 - dimensions.width / 2 + extraOuterPadding + boxOffset / 2 + i * boxOffset;\n      return x;\n    }\n\n    function boxWidthWithPadding(dimensions, extraOuterPadding, boxPadding) {\n      const boxWidth = (dimensions.width - 2 * extraOuterPadding - boxPadding * (boxes.length - 1)) / boxes.length;\n      return boxWidth;\n    }\n\n    const boxWidth = boxWidthWithPadding(dimensions, extraOuterPadding, boxPadding); // ------------------\n    //Draws the boxes, positions them and appends necessary callbacks \n\n    const dropBoxes = drawBoxes(svg, boxes, boxWidth);\n    dropBoxes.attr(\"transform\", (d, i) => `translate(${d.x = boxPositionFuncX(dimensions, extraOuterPadding, i)}, ${d.y = 100})`).on(\"mouseover\", boxMouseOver).on(\"mouseout\", boxMouseOut);\n\n    function boxMouseOver(event, d) {\n      select(this).selectChild().attr(\"style\", \"fill:rgba(\" + d.nodeColor + \",1)\");\n      setBoxToDropIn(d.id);\n      console.log(\"box over with d.id: \" + d.id, boxToDropIn); //console.log(d.id)\n\n      if (draggingNode !== \"\") {\n        console.log(\"BEPPE: \" + draggingNode + \" & \" + d.id);\n        setTable(table.insertOrUpdateRelation(question.id, draggingNode, d.id));\n      }\n    }\n\n    function boxMouseOut(Event, d) {\n      setTimeout(function () {\n        select(this).selectChild().attr(\"style\", \"fill:rgba(\" + d.nodeColor + \",0.7)\");\n        setBoxToDropIn(\"\");\n        console.log(\"box out with d.id: \" + d.id, boxToDropIn);\n      }, 400);\n    }\n  }, [nodesRepresentation, dimensions]); //TODO check if this nodes param here is right and what it does...\n\n  return /*#__PURE__*/_jsxDEV(Box, {\n    fill: true,\n    ref: wrapperRef,\n    pad: \"small\",\n    height: \"xxlarge\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 21\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 17\n  }, this);\n}\n\n_s(LineBox, \"Lif61dWR8kOVIFcZSK/mibsdK1U=\", false, function () {\n  return [useResizeObserver];\n});\n\n_c = LineBox;\n\nfunction drawNodes(svg, data, CIRCLE_RADIUS) {\n  const node = svg.selectAll(\".node\").data(data).join(\"g\").attr('class', 'node'); // .attr(\"transform\", (d,i) => `translate(${d.x = xfunc(i)}, ${d.y = yfunc(i) })`)\n  // .call(drag()\n  //       .on(\"start\", dragstarted)\n  //       .on(\"drag\", dragged)\n  //       .on(\"end\", dragended));\n\n  node.append('circle') //.join(\"g\")\n  .attr(\"r\", CIRCLE_RADIUS).attr(\"fill\", function (d) {\n    return '#ABEBC6';\n  });\n  node.append(\"text\") //.join(\"g\")\n  .text(d => d.id).attr('text-anchor', 'middle').attr('alignment-baseline', 'middle').style('fill', '#000').style('font-size', '20px');\n  return node;\n}\n/**\n * Handles the boxes on a graphical side only. position and callbacks are handled on their own\n * TODO parameterised the drawing better, adding colors and how much to round the corners... add height aswell\n * TODO maybe come up with a ratio between height and width\n * TODO find a way to display the text on the box better\n * @param {the svg canvas in which to draw the boxes} svg \n * @param {the data of the boxes} data \n * @param {the width of each box} boxWidth \n * @returns d3 selection with all the boxes so that it is then possible to append callbacks...\n */\n\n\nfunction drawBoxes(svg, data, boxWidth) {\n  const dropBox = svg.selectAll(\".dropBox\").data(data, d => d.id).join(\"g\") //a che serve sto join?\n  .attr('class', 'dropBox'); // .attr(\"transform\", (d,i) => `translate(${d.x = (-boxWidth/2 -dimensions.width / 2  + manualPaddingBox + boxOffset/2 + i * boxOffset)}, ${d.y = 100 })`)\n  // .on(\"mouseover\", boxMouseOver)\n  // .on(\"mouseout\", boxMouseOut)\n\n  const boxRect = dropBox.append(\"rect\") // pre-defined shape\n  .attr(\"style\", d => \"fill:rgba(\" + d.nodeColor + \",0.7)\") // fill color of shape\n  .attr(\"rx\", 25) // how much to round corners \n  .attr(\"ry\", 25) // how much to round corners\n  .attr(\"width\", boxWidth).attr(\"height\", 150);\n  dropBox.append(\"text\").join(\"g\").text(d => d.id).attr(\"x\", boxWidth / 2) //Used to center the text in the box  \n  .attr('text-anchor', 'middle').attr('alignment-baseline', 'ideographic').style('fill', '#000').style('font-size', '20px');\n  return dropBox;\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"LineBox\");","map":{"version":3,"sources":["/Users/gg/dev/egoSurveyReact/egoSurveyReact/src/components/lineBox.jsx"],"names":["React","useState","useEffect","useRef","useCallback","Box","DataTable","Button","Text","Layer","Heading","TextInput","select","drag","forceSimulation","forceManyBody","forceCollide","forceCenter","tickFormat","timeHour","timeout","selectAll","useResizeObserver","forceLink","colors","LineBox","nodes","question","table","setTable","filterYou","CIRCLE_RADIUS","svgRef","wrapperRef","dimensions","nodesRepresentation","setNodesRepresentation","map","x","id","getName","selected","boxes","getBoxes","forEach","push","nodeColor","colour","boxToDropIn","setBoxToDropIn","draggingNode","setDraggingNode","memoizedCallback","insertRelation","console","log","insertOrUpdateRelation","myboxArr","filter","box","mybox","d","selectChild","attr","svg","current","remove","width","height","drawNodes","i","nodePositionFuncX","y","nodePositionFuncY","call","on","dragstarted","dragged","dragended","manualPadding","nodeOffset","length","event","raise","style","thisObject","extraOuterPadding","boxPadding","boxPositionFuncX","boxOffset","boxWidth","boxWidthWithPadding","dropBoxes","drawBoxes","boxMouseOver","boxMouseOut","Event","setTimeout","data","node","join","append","text","dropBox","boxRect"],"mappings":"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","sourcesContent":["/**\n * arranges the nodes in a row so it's possible to select them,\n * once a node is selected it bumps up and changes color\n */\n\n import React, { useState, useEffect, useRef, useCallback} from 'react';\n import { Box, DataTable, Button, Text, Layer, Heading, TextInput } from \"grommet\";\nimport {select, drag, forceSimulation, forceManyBody, forceCollide, forceCenter, tickFormat, timeHour, timeout, selectAll,} from 'd3'\nimport useResizeObserver from './useResizeObserver'\nimport { forceLink } from 'd3-force';\nimport { colors } from 'grommet/themes/base';\n\n\nexport default function LineBox({\n  nodes,\n  question,\n  table,\n  setTable, \n  filterYou,\n    }) {\n    const CIRCLE_RADIUS = 20;\n    const svgRef = useRef(); //gets a ref for the svg in which d3 renders in \n    const wrapperRef = useRef();\n    const dimensions = useResizeObserver(wrapperRef); //used to resize \n    const [nodesRepresentation, setNodesRepresentation] = React.useState(nodes.map(x => {\n      return {\n        id: x.getName(),\n        selected: false\n      }\n    }))\n\n      //TODO NINAD, HERE THE BOXES ARE DECLERED, MAYBE MAKE A MODEL, IDK HOW U WANT TO MAKE  THE STATE OUT OF THESE.\n        //const boxes = [{id: \"1\", nodeColor: \"ffa500\"},{id: \"22\", nodeColor: \"ffa500\"},{id: \"333\", nodeColor: \"ffa500\"}, {id: \"4444444\", nodeColor: \"ffa500\"}]\n        const boxes = []\n        question.getBoxes().forEach(x => {\n          boxes.push({id: x.id, nodeColor: x.colour})\n        })\n        \n\n    //keeps the state of which box is curently being hovered on\n    const [boxToDropIn, setBoxToDropIn] = React.useState(\"\")\n    const [draggingNode, setDraggingNode] = React.useState(\"\")\n\n    const memoizedCallback = useCallback(\n      () => {\n        if(draggingNode !== \"\" && boxToDropIn !== \"\")\n        setTable(table.insertRelation(question.id, draggingNode, boxToDropIn))\n        console.log(\"draggingNode\", draggingNode)\n        console.log(\"boxToDropIn\", boxToDropIn)\n      },\n      [draggingNode, boxToDropIn],\n    );\n    /**\n     * useless use effect, just used to check if the logic was working, ultimately to be removed. \n     */\n     useEffect(()=> {\n      console.log(\"useEffect draggingNode: \" + draggingNode)\n    },[draggingNode])\n\n    //Temporary solution. ADD PADDING BETWEEN BOXES OF MINIMUM SIZE OF NODE. AND ALSO REDUCE NODE SIZE.\n    useEffect(()=> {\n      console.log(\"useEffect box: \" + boxToDropIn)\n      if(draggingNode !== \"\"){\n        console.log(\"BEPPE: \"+draggingNode+\" & \"+boxToDropIn)\n        setTable(table.insertOrUpdateRelation(question.id, draggingNode, boxToDropIn))\n        const myboxArr = boxes.filter(box => box.id === boxToDropIn)\n        const mybox = myboxArr[0];\n        selectAll(\".node\")\n        .filter(function(d) { return d.id === draggingNode })\n        .selectChild()\n        .attr(\"fill\", function (d) { return mybox.nodeColor; });  \n\n      }\n    },[boxToDropIn])\n\n      // will be called initially and on every data change\n    useEffect(() => {\n      if (!dimensions) return;\n\n        // console.log(\"width\", dimensions.width)\n        \n        const svg = select(svgRef.current);\n        svg.selectAll(\"*\").remove(); //Clear canvas so no duplicates are trailed every refresh\n            // centering workaround\n    svg.attr(\"viewBox\", [\n        -dimensions.width / 2,\n        -dimensions.height / 2,\n        dimensions.width,\n        dimensions.height\n      ]);\n\n      /**\n       * Draws the nodes on screen, appends the callbacks.\n       */\n  const nodes = drawNodes(svg, nodesRepresentation, CIRCLE_RADIUS)\n      nodes  \n      .attr(\"transform\", (d,i) => `translate(${d.x = nodePositionFuncX(i, dimensions)}, ${d.y = nodePositionFuncY(i) })`)\n      .call(drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n     // .attr(\"transform\", (d,i) => `translate(${d.x = }, ${d.y = 0 })`)\n\n\n \n\n      function nodePositionFuncX(i, dimensions){\n        const manualPadding = 100\n        const nodeOffset = (dimensions.width - 2* manualPadding)/ nodesRepresentation.length\n        const x = (-dimensions.width / 2  + manualPadding + nodeOffset/2 + i * nodeOffset)\n        return x\n      }\n      function nodePositionFuncY(i, dimensions){\n        return 0\n      }\n\n        function dragstarted(event, d) {\n          setDraggingNode(d.id)\n          console.log(\"dragstarted\", boxToDropIn)\n          select(this).raise().attr(\"stroke\", \"black\")\n          .style(\"pointer-events\", \"none\"); //this is done so that the mouseover event on the box can be detected\n        }\n      \n        function dragged(event, d) {\n          console.log(\"dragged\", boxToDropIn)\n          select(this)\n          .attr(\"transform\", () => `translate(${d.x = event.x}, ${d.y = event.y })`)\n        }\n      \n      \n\n        /**\n         * TODO NINAD : insert here the logic to save the state of the node being in a box if \n         * if boxTodropIn is not empty. \n         * ISSUES: select with the box id doesn't seem to be working\n         * TODO: re insert the logic so that the node can be dragged again after it is dropped the first time \n         * @param {*} event \n         * @param {*} d \n         */\n        function dragended(event, d) {\n          setDraggingNode(\"\")\n          const thisObject = this\n          /*setTimeout(function() {\n            console.log(\"dragended\", boxToDropIn)\n            if(boxToDropIn !== \"\"){\n              console.log(\"inside if\")\n              setTable(table.insertRelation(question.id, d.id, boxToDropIn))\n            }\n            select(thisObject).attr(\"stroke\", null)\n            .style(\"pointer-events\", \"auto\")\n          }, 100);*/\n          console.log(\"dragended\", boxToDropIn)\n            if(boxToDropIn !== \"\"){\n              console.log(\"inside if\")\n              setTable(table.insertRelation(question.id, d.id, boxToDropIn))\n            }\n            select(thisObject).attr(\"stroke\", null)\n            .style(\"pointer-events\", \"auto\")\n        }\n      \n\n  // ------FUNCTIONS FOR BOXES POSITION  AND SIZE  \n      const extraOuterPadding = 0 //this is extra for outer pad. total outer pad is manual + inner\n      const boxPadding = 70\n      function boxPositionFuncX(dimensions, extraOuterPadding, i){\n        const boxOffset = (dimensions.width - 2* extraOuterPadding)/ boxes.length\n        const x = (-boxWidth/2 -dimensions.width / 2  + extraOuterPadding + boxOffset/2 + i * boxOffset)\n        return x\n      }\n\n      function boxWidthWithPadding(dimensions, extraOuterPadding, boxPadding ){\n        const boxWidth = (dimensions.width - 2*extraOuterPadding - boxPadding*(boxes.length-1))/ boxes.length\n        return boxWidth\n      }\n\n      const boxWidth = boxWidthWithPadding(dimensions, extraOuterPadding, boxPadding)\n  // ------------------\n\n      //Draws the boxes, positions them and appends necessary callbacks \n      const dropBoxes = drawBoxes(svg, boxes, boxWidth)\n      dropBoxes\n      .attr(\"transform\", (d,i) => `translate(${d.x = boxPositionFuncX(dimensions, extraOuterPadding, i ) }, ${d.y = 100 })`)\n      .on(\"mouseover\", boxMouseOver)\n      .on(\"mouseout\", boxMouseOut)\n      \n\n\n      function boxMouseOver(event, d){\n        select(this).selectChild()\n        .attr(\"style\", \"fill:rgba(\"+d.nodeColor+\",1)\");\n        setBoxToDropIn(d.id)\n        \n        console.log(\"box over with d.id: \"+d.id, boxToDropIn)\n        //console.log(d.id)\n\n        if(draggingNode !== \"\"){\n          console.log(\"BEPPE: \"+draggingNode+\" & \"+d.id)\n          setTable(table.insertOrUpdateRelation(question.id, draggingNode, d.id))\n        }\n      }\n      function boxMouseOut(Event, d){\n        setTimeout(function() {\n          select(this).selectChild()\n          .attr(\"style\", \"fill:rgba(\"+d.nodeColor+\",0.7)\");\n          setBoxToDropIn(\"\")\n          console.log(\"box out with d.id: \"+d.id, boxToDropIn)\n        }, 400);\n\n      }\n\n\n      }, [nodesRepresentation, dimensions]); //TODO check if this nodes param here is right and what it does...\n\n        return(\n                <Box fill={true} ref={wrapperRef}  pad=\"small\" height=\"xxlarge\">\n                    <svg ref={svgRef}></svg>\n                </Box>\n        )\n}\n\nfunction drawNodes(svg, data, CIRCLE_RADIUS){\n  const node = svg\n  .selectAll(\".node\")\n  .data(data)\n  .join(\"g\")\n  .attr('class', 'node')\n  // .attr(\"transform\", (d,i) => `translate(${d.x = xfunc(i)}, ${d.y = yfunc(i) })`)\n  // .call(drag()\n  //       .on(\"start\", dragstarted)\n  //       .on(\"drag\", dragged)\n  //       .on(\"end\", dragended));\n\n\nnode.append('circle')\n  //.join(\"g\")\n  .attr(\"r\", CIRCLE_RADIUS)\n  .attr(\"fill\", function (d) { return '#ABEBC6'; });  \n\n\nnode.append(\"text\")\n  //.join(\"g\")\n  .text(d => d.id)\n  .attr('text-anchor', 'middle')\n  .attr('alignment-baseline', 'middle')\n  .style('fill', '#000')\n  .style('font-size', '20px');\n  return node \n}\n\n/**\n * Handles the boxes on a graphical side only. position and callbacks are handled on their own\n * TODO parameterised the drawing better, adding colors and how much to round the corners... add height aswell\n * TODO maybe come up with a ratio between height and width\n * TODO find a way to display the text on the box better\n * @param {the svg canvas in which to draw the boxes} svg \n * @param {the data of the boxes} data \n * @param {the width of each box} boxWidth \n * @returns d3 selection with all the boxes so that it is then possible to append callbacks...\n */\nfunction drawBoxes(svg, data, boxWidth){\n  const dropBox = svg\n  .selectAll(\".dropBox\")\n  .data(data, d => d.id)\n  .join(\"g\")  //a che serve sto join?\n  .attr('class', 'dropBox')\n  // .attr(\"transform\", (d,i) => `translate(${d.x = (-boxWidth/2 -dimensions.width / 2  + manualPaddingBox + boxOffset/2 + i * boxOffset)}, ${d.y = 100 })`)\n  // .on(\"mouseover\", boxMouseOver)\n  // .on(\"mouseout\", boxMouseOut)\n\n  const boxRect = dropBox.append(\"rect\")\t\t// pre-defined shape\n  .attr(\"style\", d => \"fill:rgba(\"+d.nodeColor+\",0.7)\")\t// fill color of shape\n    .attr(\"rx\", 25)\t\t\t\t\t\t\t\t// how much to round corners \n    .attr(\"ry\", 25)\t\t\t\t\t\t\t\t// how much to round corners\n    .attr(\"width\", boxWidth)\t\t\t\t\t\n    .attr(\"height\", 150);\n    \n  dropBox.append(\"text\")\n    .join(\"g\")\n    .text(d => d.id)\n    .attr(\"x\", boxWidth/2)              //Used to center the text in the box  \n    .attr('text-anchor', 'middle')\n    .attr('alignment-baseline', 'ideographic')\n    .style('fill', '#000')\n    .style('font-size', '20px');\n    \n    return dropBox\n}"]},"metadata":{},"sourceType":"module"}